# C99 Style Guide for CSS Remover

## General Philosophy
- **K.I.S.S.**: Keep It Simple, Stupid.
- **Explicit is better than implicit**.
- **Data-Oriented**: Think about memory layout and access patterns.

## Formatting & Conventions (enforced by clang-format/tidy)
- **Indentation**: 4 spaces.
- **Braces**: Allman style or K&R (consistent).
- **Naming**: 
    - Variables/Functions: `snake_case` (e.g., `process_css`, `input_file`).
    - Types: `snake_case_t` (e.g., `css_context_t`).
    - Constants/Macros: `UPPER_SNAKE_CASE`.
- **Comments**: `//` for single lines, `/* ... */` for blocks. API docs in headers.

## C99 Specifics
- **Variable Declarations**: close to usage (not just at top of scope), but within reason.
- **Designated Initializers**: Use them for structs.
  ```c
  config_t cfg = {
      .input = "file.css",
      .verbose = true,
  };
  ```
- **Compound Literals**: Useful for one-off structs.
- **`stdbool.h`**: Use `bool`, `true`, `false`.
- **`stdint.h`**: Use `uint8_t`, `int32_t`, `size_t` (prefer fixed width for data structures).

## Safety & Robustness
- **Error Handling**: Return error codes or `NULL`. Avoid global `errno` assumption.
- **Memory**: 
    - Check malloc/calloc results.
    - Prefer arena/region allocators if complex (but `malloc` is fine for this scale).
    - Use `defer` pattern if mimicking Go (via macros) or just careful `goto cleanup`.
- **Strings**: Be careful with null-terminators. Use length-bounded string functions when possible.

## Libraries
- **Unity**: For testing. One assertion per test concept.
- **ZPL**: Use `zpl_` prefixed functions.
- **Liblexbor**: Check documentation for correct object lifecycle management. Use it for both CSS and HTML parsing.

## Parsing Strategy
- **HTML**: Use `liblexbor` HTML parser. Do not use Regex.
- **JS**: Use a simple tokenizer/lexer approach.
    - Scan for string literals (single/double quotes, backticks).
    - Ignore comments (`//` and `/* ... */`).
    - Extract potential class names from strings.
    - **Avoid Regex**: It is fragile and adds unnecessary dependency for this use case.


## Project Specific
- **Input/Output**: Separate IO logic from processing logic for better testability.
- **No Globals**: Pass context structs.
